# ShellTabs Feature & Source Audit

## Current Coded Features
- **Explorer deskband with persistent tab management.** `TabBand.cpp`, `TabBandWindow.cpp`, and `TabManager.cpp` expose the deskband COM object, paint the band window, and coordinate tab activation/grouping, while `ShellTabsListView.cpp` and `ShellTabsTreeView.cpp` synchronize host list/tree views and tab highlights, establishing the core tabbed Explorer UX.【F:src/TabBand.cpp†L162-L200】【F:src/TabBandWindow.cpp†L1-L160】【F:src/TabManager.cpp†L1-L90】【F:src/ShellTabsListView.cpp†L1-L120】【F:src/ShellTabsTreeView.cpp†L1-L90】
- **Background, preview, and icon caching.** `BackgroundCache.cpp`, `PreviewCache.cpp`, `PreviewOverlay.cpp`, and `IconCache.cpp` maintain disk caches for folder wallpapers, thumbnail captures, floating preview overlays, and icon bitmaps, including asynchronous maintenance and deletion logic.【F:src/BackgroundCache.cpp†L26-L430】【F:src/PreviewCache.cpp†L19-L140】【F:src/PreviewOverlay.cpp†L290-L380】【F:src/IconCache.cpp†L1-L80】
- **Breadcrumb gradient and edit overlays.** `BreadcrumbGradient.cpp`, `EditGradientRenderer.cpp`, and `ExplorerThemeUtils.cpp` build gradient palettes, repaint Explorer's address bar/edit controls with DPI-aware gradients, and sample Explorer chrome colors to blend correctly with light/dark modes.【F:src/BreadcrumbGradient.cpp†L27-L76】【F:src/EditGradientRenderer.cpp†L29-L160】【F:src/ExplorerThemeUtils.cpp†L1-L66】
- **Explorer browser helper and pane hooks.** `BrowserEvents.cpp`, `CExplorerBHO.cpp`, and `PaneHooks.cpp` implement the BHO that subscribes to Explorer events, injects custom DirectUI replacements, and tracks pane highlights, enabling ShellTabs to monitor navigation and paint custom surfaces.【F:src/BrowserEvents.cpp†L91-L278】【F:src/CExplorerBHO.cpp†L1090-L1134】【F:src/PaneHooks.cpp†L1-L130】
- **Theming, glow, and composition interceptors.** `ThemeHooks.cpp`, `CompositionIntercept.cpp`, `ExplorerGlowSurfaces.cpp`, `ThemeNotifier.cpp`, and `DpiUtils.cpp` detour theme APIs, wrap DirectComposition surfaces, compute glow rectangles, listen to system theme changes, and manage per-monitor DPI awareness to keep overlays in sync.【F:src/ThemeHooks.cpp†L1-L120】【F:src/CompositionIntercept.cpp†L1-L200】【F:src/ExplorerGlowSurfaces.cpp†L32-L140】【F:src/ThemeNotifier.cpp†L1-L120】【F:src/DpiUtils.cpp†L1-L60】
- **FTP namespace integration.** `FtpClient.cpp`, `FtpShellFolder.cpp`, `FtpPidl.cpp`, and `FtpUrl.cpp` provide pooled FTP transports, a custom shell folder implementation, PIDL serialization helpers, and URL parsing so remote FTP sites can appear as ShellTabs nodes.【F:src/FtpClient.cpp†L1127-L1187】【F:src/FtpShellFolder.cpp†L1-L120】【F:src/FtpPidl.cpp†L1-L80】【F:src/FtpUrl.cpp†L1-L80】
- **Options, group, and session persistence.** `OptionsStore.cpp`, `GroupStore.cpp`, and `SessionStore.cpp` parse custom config files, persist saved groups/islands, and maintain crash-resistant session checkpoints, keeping tab state across Explorer restarts.【F:src/OptionsStore.cpp†L1-L100】【F:src/GroupStore.cpp†L42-L140】【F:src/SessionStore.cpp†L1-L80】
- **Shell integration utilities.** `ClassFactory.cpp`, `OpenFolderCommand.cpp`, `dllmain.cpp`, `resource.rc`, `ShellTabs.manifest`, `Guids.cpp`, and `ShellTabsMessages.cpp` provide COM registration, Explorer command verbs, DLL lifecycle management, and shared message IDs so Explorer can instantiate ShellTabs components cleanly.【F:src/ClassFactory.cpp†L15-L120】【F:src/OpenFolderCommand.cpp†L1-L120】【F:src/dllmain.cpp†L1-L60】【F:src/resource.rc†L1-L34】【F:src/ShellTabs.manifest†L1-L10】【F:src/Guids.cpp†L1-L30】【F:src/ShellTabsMessages.cpp†L1-L20】
- **Support libraries and diagnostics.** `Logging.cpp`, `Utilities.cpp`, `StringUtils.cpp`, `ColorSerialization.cpp`, `ColorUtils.cpp`, `ComUtils.cpp`, `ComVTableHook.cpp`, `Notifications.cpp`, and `BackgroundCache.cpp` (shared helpers) handle logging, file I/O, Unicode/string parsing, color math, COM GUID helpers, MinHook-based vtable detours, toast notifications, and cache maintenance infrastructure.【F:src/Logging.cpp†L1-L80】【F:src/Utilities.cpp†L1-L80】【F:src/StringUtils.cpp†L1-L80】【F:src/ColorSerialization.cpp†L8-L64】【F:src/ColorUtils.cpp†L9-L30】【F:src/ComUtils.cpp†L17-L26】【F:src/ComVTableHook.cpp†L28-L145】【F:src/Notifications.cpp†L1-L80】

## Implementation Status by Source File

### Fully Implemented
| Files | Highlights |
| --- | --- |
| `BackgroundCache.cpp`, `PreviewCache.cpp`, `PreviewOverlay.cpp`, `IconCache.cpp` | Implement directory-scoped cache maintenance, asynchronous preview capture, layered preview overlays, and PIDL-aware icon caching (including cleanup of stale items).【F:src/BackgroundCache.cpp†L26-L430】【F:src/PreviewCache.cpp†L19-L140】【F:src/PreviewOverlay.cpp†L290-L368】【F:src/IconCache.cpp†L1-L70】 |
| `BreadcrumbGradient.cpp`, `EditGradientRenderer.cpp`, `ExplorerThemeUtils.cpp` | Resolve gradient palettes, repaint Explorer edits with DPI-aware gradients, and sample Explorer chrome to adapt colors for light/dark/high-contrast modes.【F:src/BreadcrumbGradient.cpp†L27-L76】【F:src/EditGradientRenderer.cpp†L29-L140】【F:src/ExplorerThemeUtils.cpp†L1-L70】 |
| `BrowserEvents.cpp`, `CExplorerBHO.cpp`, `PaneHooks.cpp` | Provide COM event sinks, bootstrap the BHO (including DirectUI replacement callbacks), and coordinate pane highlight invalidation for list/tree views.【F:src/BrowserEvents.cpp†L91-L278】【F:src/CExplorerBHO.cpp†L1090-L1134】【F:src/PaneHooks.cpp†L1-L130】 |
| `ThemeHooks.cpp`, `CompositionIntercept.cpp`, `ExplorerGlowSurfaces.cpp`, `ThemeNotifier.cpp`, `DpiUtils.cpp` | Hook uxtheme/GDI APIs, wrap DirectComposition targets, compute glow rectangles via UIAutomation, listen for system theme/color changes, and keep painting DPI-consistent.【F:src/ThemeHooks.cpp†L1-L120】【F:src/CompositionIntercept.cpp†L1-L140】【F:src/ExplorerGlowSurfaces.cpp†L32-L130】【F:src/ThemeNotifier.cpp†L1-L120】【F:src/DpiUtils.cpp†L1-L60】 |
| `TabBand.cpp`, `TabBandWindow.cpp`, `TabManager.cpp`, `ShellTabsListView.cpp`, `ShellTabsTreeView.cpp`, `ShellTabsMessages.cpp` | Expose the IDeskBand2 implementation, render the custom band window/new-tab control, maintain tab/group state, and mirror list/tree selection with registered window messages.【F:src/TabBand.cpp†L162-L200】【F:src/TabBandWindow.cpp†L1-L140】【F:src/TabManager.cpp†L1-L80】【F:src/ShellTabsListView.cpp†L1-L120】【F:src/ShellTabsTreeView.cpp†L1-L80】【F:src/ShellTabsMessages.cpp†L1-L20】 |
| `OptionsStore.cpp`, `GroupStore.cpp`, `SessionStore.cpp` | Parse persisted configuration formats, maintain saved groups/islands, and checkpoint sessions with integrity checks/lock files to guard against crash corruption.【F:src/OptionsStore.cpp†L1-L70】【F:src/GroupStore.cpp†L42-L140】【F:src/SessionStore.cpp†L1-L80】 |
| `FtpClient.cpp`, `FtpShellFolder.cpp`, `FtpPidl.cpp`, `FtpUrl.cpp` | Implement pooled FTP sessions (WinInet/WinHTTP/raw sockets), expose a COM `IShellFolder` for FTP namespaces, serialize PIDLs, and normalize FTP URIs for storage/navigation.【F:src/FtpClient.cpp†L1127-L1185】【F:src/FtpShellFolder.cpp†L1-L110】【F:src/FtpPidl.cpp†L1-L70】【F:src/FtpUrl.cpp†L1-L70】 |
| `DirectUIReplacementIntegration.cpp` (core), `ShellTabsListView.cpp` | Register custom file list window classes, monitor DirectUI replacements, and attach host list views to shell views for painting and selection mirroring.【F:src/DirectUIReplacementIntegration.cpp†L1-L110】【F:src/ShellTabsListView.cpp†L1-L120】 |
| `ExplorerRibbonHook.cpp` (hook infrastructure) | Hooks Explorer’s ribbon framework and registers button callbacks, preparing for custom tabs by invalidating/enabling custom command IDs.【F:src/ExplorerRibbonHook.cpp†L430-L520】 |
| `Logging.cpp`, `Utilities.cpp`, `StringUtils.cpp`, `ColorSerialization.cpp`, `ColorUtils.cpp`, `ComUtils.cpp`, `ComVTableHook.cpp`, `Notifications.cpp` | Provide logging/minidump infrastructure, filesystem helpers, config parsing, color math, GUID helpers, MinHook detours, and toast notifications for automation policy issues.【F:src/Logging.cpp†L1-L70】【F:src/Utilities.cpp†L1-L70】【F:src/StringUtils.cpp†L1-L70】【F:src/ColorSerialization.cpp†L8-L64】【F:src/ColorUtils.cpp†L9-L30】【F:src/ComUtils.cpp†L17-L24】【F:src/ComVTableHook.cpp†L28-L145】【F:src/Notifications.cpp†L1-L80】 |
| `ClassFactory.cpp`, `OpenFolderCommand.cpp`, `dllmain.cpp`, `resource.rc`, `ShellTabs.manifest`, `Guids.cpp`, `ShellTabsMessages.cpp`, `Module.cpp` | Supply COM class factories, Explorer verb invocation logic, registration/installation routines, resource metadata, GUID constants, shared window messages, and module lifetime helpers.【F:src/ClassFactory.cpp†L15-L120】【F:src/OpenFolderCommand.cpp†L1-L120】【F:src/dllmain.cpp†L1-L60】【F:src/resource.rc†L1-L34】【F:src/ShellTabs.manifest†L1-L10】【F:src/Guids.cpp†L1-L30】【F:src/ShellTabsMessages.cpp†L1-L20】【F:src/Module.cpp†L1-L40】 |
| `IconCache.cpp`, `PreviewCache.cpp`, `BackgroundCache.cpp`, `PaneHooks.cpp` | Normalize PIDL/file keys, capture shell thumbnails, recycle background caches, and keep list/tree view highlights invalidated for smooth UI updates.【F:src/IconCache.cpp†L1-L70】【F:src/PreviewCache.cpp†L19-L120】【F:src/BackgroundCache.cpp†L26-L120】【F:src/PaneHooks.cpp†L32-L120】 |
| `ExplorerGlowSurfaces.cpp`, `CompositionIntercept.cpp`, `ThemeHooks.cpp` | Enumerate DirectUI rectangles, intercept DirectComposition targets, and detour draw-theme APIs so ShellTabs glow effects render consistently across Explorer UI.【F:src/ExplorerGlowSurfaces.cpp†L32-L130】【F:src/CompositionIntercept.cpp†L1-L140】【F:src/ThemeHooks.cpp†L1-L110】 |
| `ShellTabsTreeView.cpp`, `PaneHooks.cpp` | Repaint Explorer’s navigation tree with gradient text and accent borders, honoring accessibility and high-contrast checks.【F:src/ShellTabsTreeView.cpp†L1-L120】【F:src/PaneHooks.cpp†L1-L90】 |
| `Utilities.cpp`, `StringUtils.cpp`, `ColorSerialization.cpp`, `ColorUtils.cpp` | Offer shared parsing/formatting for UTF-8 files, whitespace trimming, boolean/int parsing, and color serialization for persisted options.【F:src/Utilities.cpp†L1-L80】【F:src/StringUtils.cpp†L1-L80】【F:src/ColorSerialization.cpp†L8-L64】【F:src/ColorUtils.cpp†L9-L30】 |

### Partially Implemented
| Files | Gaps |
| --- | --- |
| `CustomFileListView.cpp` | The custom view handles painting, input, shell notifications, and clipboard actions but still lacks cut visual cues and IDropSource drag/drop plumbing noted via TODOs in the cut/drag handlers.【F:src/CustomFileListView.cpp†L54-L132】【F:src/CustomFileListView.cpp†L2140-L2212】 |
| `OptionsDialog.cpp` | Page handling is wired up, yet the context tree selection handler still contains a TODO to load selected item properties into the edit controls, leaving that UX unfinished.【F:src/OptionsDialog.cpp†L1989-L2006】 |
| `dllmain.cpp` | Registration/unregistration logic is complete, but folder background hooks are referenced with a TODO include comment, signaling that feature has not been implemented yet.【F:src/dllmain.cpp†L13-L21】 |
| `ExplorerRibbonHook.cpp`, `CustomRibbonTab.xml` | Hook infrastructure invalidates/enables custom ribbon commands, but the XML resource explicitly requires compilation via UICC and inclusion in the RC file before Explorer can display the tab, so the feature is present but depends on external build steps not yet wired into resources.【F:src/ExplorerRibbonHook.cpp†L430-L520】【F:src/CustomRibbonTab.xml†L1-L40】 |

### Implemented but Not Used
- **None identified.** Every source file under `src/` is referenced by the core deskband, Explorer hooks, or supporting infrastructure after reviewing the entire tree.

### Replaced/Useless Features
- **None identified.** No obsolete or superseded feature blocks were found; existing functionality is either active or marked as TODO for future completion.
